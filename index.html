<html>
<head>
  <title>My first three.js app</title>
  <style>
  body { margin: 0; }
  canvas { width: 100%; height: 100% }
  </style>
</head>
<body>
  <script src="/js/three.min.js"></script>
  <script src="/js/OrbitControls.js"></script>
  <script>
  const dd = 100
  const p = 0.05
  var container = {
    x: 800/dd,
    y: 800/dd,
    z: 1400/dd,
  }
  var tyre =   {
    x: 150/dd,
    y: 30/dd,
    z: 150/dd,
  }

  const fixOrigin = function(mesh, x, y, z) {
    boundingBox = new THREE.Box3().setFromObject(mesh)
    var size = new THREE.Vector3();
    boundingBox.getSize(size)
    mesh.position.set(x+size.x/2, y+size.y/2, z+size.z/2)
    // console.log(size);
  }

  const addTyre = function(scene, radius, height, x, y, z, color, rotation=0) {
    // Add mesh
    var geometry = new THREE.CylinderGeometry(radius-0.001, radius-0.001, height-0.001, 100 );
    var material = new THREE.MeshBasicMaterial( { color } );
    var mesh = new THREE.Mesh( geometry, material );
    scene.add( mesh );
    if(rotation!=0) {
      mesh.rotation.z = rotation
    }
    fixOrigin(mesh, x, y, z);
    // Add outline mesh
    var outlineMaterial = new THREE.MeshBasicMaterial( { color: 0xffffff, side: THREE.BackSide } );
    var outlineMesh = new THREE.Mesh( geometry, outlineMaterial );
    outlineMesh.scale.multiplyScalar(1.01);
    scene.add( outlineMesh );
    if(rotation!=0) {
      outlineMesh.rotation.z = rotation
    }
    fixOrigin(outlineMesh, x, y, z);
  }

  var scene = new THREE.Scene();
  var camera = new THREE.PerspectiveCamera( 75, window.innerWidth/window.innerHeight, 0.1, 1000 );

  var renderer = new THREE.WebGLRenderer();
  renderer.setSize( window.innerWidth, window.innerHeight );
  document.body.appendChild( renderer.domElement );
  controls = new THREE.OrbitControls( camera, renderer.domElement );

  // Container
  var containerGeometry = new THREE.BoxBufferGeometry( container.x, container.y, container.z );
  var containerEdges = new THREE.EdgesGeometry( containerGeometry );
  var containerLines = new THREE.LineSegments( containerEdges, new THREE.LineBasicMaterial( { color: 0xffffff } ) );
  scene.add( containerLines );
  fixOrigin(containerLines, 0, 0, 0)
  // containerLines.position.set(container.x/2, container.y/2, container.z/2)

  camera.position.z = 5;

  // addTyre(scene, radius, height, x, y, z, color);
  var pos = {x: 0, y: 0, z: 0};
  // Layer1
  addTyre(scene, tyre.x/2, tyre.y, pos.x, pos.y, pos.z, 0xffff00);
  pos.x += tyre.x/2;
  addTyre(scene, tyre.x/2, tyre.y, pos.x, pos.y, pos.z, 0xffff00, -(Math.PI / 10));
  pos.x += tyre.x/2;
  addTyre(scene, tyre.x/2, tyre.y, pos.x, pos.y, pos.z, 0xffff00, -(Math.PI / 10));
  pos.x += tyre.x/2;
  addTyre(scene, tyre.x/2, tyre.y, pos.x, pos.y, pos.z, 0xffff00, -(Math.PI / 10));
  pos.x += tyre.x/2;
  addTyre(scene, tyre.x/2, tyre.y, pos.x, pos.y, pos.z, 0xffff00, -(Math.PI / 10));
  pos.x += tyre.x/2;
  addTyre(scene, tyre.x/2, tyre.y, pos.x, pos.y, pos.z, 0xffff00, -(Math.PI / 10));
  pos.x += tyre.x/2;
  addTyre(scene, tyre.x/2, tyre.y, pos.x, pos.y, pos.z, 0xffff00, -(Math.PI / 10));
  pos.x += tyre.x/2;
  addTyre(scene, tyre.x/2, tyre.y, pos.x, pos.y, pos.z, 0xffff00, -(Math.PI / 10));
  pos.x += tyre.x/2;
  addTyre(scene, tyre.x/2, tyre.y, pos.x, pos.y, pos.z, 0xffff00, -(Math.PI / 10));




  var animate = function () {
    requestAnimationFrame( animate );

    renderer.render( scene, camera );
  };

  animate();
  </script>
</body>
</html>
